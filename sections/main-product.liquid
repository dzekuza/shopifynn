<section class="product section" data-product style="padding-top: {{ section.settings.padding_top }}px; padding-bottom: {{ section.settings.padding_bottom }}px;">
  <div class="container">
    <div class="product__grid">
      <!-- Product Gallery -->
      <div class="product__media">
        <div class="product__media-main">
          {% if product.featured_image %}
            <img
              id="product-main-image"
              src="{{ product.featured_image | image_url: width: 800 }}"
              srcset="
                {{ product.featured_image | image_url: width: 400 }} 400w,
                {{ product.featured_image | image_url: width: 600 }} 600w,
                {{ product.featured_image | image_url: width: 800 }} 800w,
                {{ product.featured_image | image_url: width: 1200 }} 1200w
              "
              sizes="(max-width: 768px) 100vw, 50vw"
              alt="{{ product.featured_image.alt | escape | default: product.title }}"
              class="product__main-image"
            >
          {% else %}
            <div class="product__placeholder">
              <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="var(--color-text-muted)" stroke-width="1">
                <rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/>
              </svg>
            </div>
          {% endif %}
        </div>

        {% if product.images.size > 1 %}
          <div class="product__thumbnails">
            {% for image in product.images %}
              <button
                class="product__thumbnail {% if forloop.first %}product__thumbnail--active{% endif %}"
                data-thumbnail
                data-image-url="{{ image | image_url: width: 800 }}"
                data-srcset="{{ image | image_url: width: 400 }} 400w, {{ image | image_url: width: 600 }} 600w, {{ image | image_url: width: 800 }} 800w, {{ image | image_url: width: 1200 }} 1200w"
                data-alt="{{ image.alt | escape | default: product.title }}"
                aria-label="View image {{ forloop.index }}"
              >
                <img
                  src="{{ image | image_url: width: 120 }}"
                  alt="{{ image.alt | escape | default: product.title }}"
                  loading="lazy"
                >
              </button>
            {% endfor %}
          </div>
        {% endif %}
      </div>

      <!-- Product Info -->
      <div class="product__info">
        {% for block in section.blocks %}
          {% case block.type %}

            {% when 'title' %}
              <div class="product__block" {{ block.shopify_attributes }}>
                {% if section.settings.show_vendor and product.vendor != blank %}
                  <p class="product__vendor">{{ product.vendor }}</p>
                {% endif %}
                <h1 class="product__title" style="font-size: {% if section.settings.heading_size == 'small' %}1.5rem{% elsif section.settings.heading_size == 'large' %}2.5rem{% else %}2rem{% endif %};">{{ product.title }}</h1>
              </div>

            {% when 'price' %}
              <div class="product__block" {{ block.shopify_attributes }}>
                <div class="product__price-wrap">
                  <span class="product__price" data-product-price>
                    {{ product.selected_or_first_available_variant.price | money }}
                  </span>
                  {% if product.selected_or_first_available_variant.compare_at_price > product.selected_or_first_available_variant.price %}
                    <span class="product__compare-price" data-compare-price>
                      {{ product.selected_or_first_available_variant.compare_at_price | money }}
                    </span>
                    <span class="product__save-badge">
                      Save {{ product.selected_or_first_available_variant.compare_at_price | minus: product.selected_or_first_available_variant.price | money }}
                    </span>
                  {% endif %}
                </div>
                {% if block.settings.show_tax_notice %}
                  <p class="product__tax-notice">{{ block.settings.tax_text }}</p>
                {% endif %}
              </div>

            {% when 'variant_picker' %}
              <div class="product__block" {{ block.shopify_attributes }}>
                {% unless product.has_only_default_variant %}
                  {% for option in product.options_with_values %}
                    <div class="product__option">
                      <label class="product__option-label" for="option-{{ option.name | handleize }}">
                        {{ option.name }}
                      </label>
                      <select
                        id="option-{{ option.name | handleize }}"
                        class="product__option-select"
                        data-option-index="{{ forloop.index0 }}"
                      >
                        {% for value in option.values %}
                          <option value="{{ value | escape }}" {% if option.selected_value == value %}selected{% endif %}>
                            {{ value }}
                          </option>
                        {% endfor %}
                      </select>
                    </div>
                  {% endfor %}
                {% endunless %}
              </div>

            {% when 'quantity_selector' %}
              <div class="product__block" {{ block.shopify_attributes }}>
                <label class="product__option-label" for="product-quantity">Quantity</label>
                <div class="product__quantity">
                  <button type="button" class="product__quantity-btn" data-quantity-minus aria-label="Decrease quantity">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="5" y1="12" x2="19" y2="12"/></svg>
                  </button>
                  <input type="number" id="product-quantity" class="product__quantity-input" value="1" min="1" data-quantity-input>
                  <button type="button" class="product__quantity-btn" data-quantity-plus aria-label="Increase quantity">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                  </button>
                </div>
              </div>

            {% when 'buy_buttons' %}
              <div class="product__block" {{ block.shopify_attributes }}>
                <form method="post" action="/cart/add" data-product-form>
                  <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}" data-variant-id>
                  <input type="hidden" name="quantity" value="1" data-form-quantity>
                  <button
                    type="submit"
                    class="button button--primary product__add-to-cart"
                    {% unless product.selected_or_first_available_variant.available %}disabled{% endunless %}
                  >
                    {% if product.selected_or_first_available_variant.available %}
                      {{ block.settings.button_text | default: 'Add to Cart' }}
                    {% else %}
                      Sold Out
                    {% endif %}
                  </button>
                  {% if block.settings.show_dynamic_checkout %}
                    {{ form | payment_button }}
                  {% endif %}
                </form>
              </div>

            {% when 'description' %}
              <div class="product__block" {{ block.shopify_attributes }}>
                {% if product.description != blank %}
                  <div class="product__description rte">
                    {{ product.description }}
                  </div>
                {% endif %}
              </div>

            {% when 'collapsible_tab' %}
              <div class="product__block product__collapsible" {{ block.shopify_attributes }}>
                <button class="product__collapsible-trigger" data-collapsible-trigger aria-expanded="false">
                  <span>
                    {% if block.settings.icon != 'none' %}
                      <span class="product__collapsible-icon">
                        {% case block.settings.icon %}
                          {% when 'box' %}
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 002 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0022 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></svg>
                          {% when 'truck' %}
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="1" y="3" width="15" height="13"/><polygon points="16 8 20 8 23 11 23 16 16 16 16 8"/><circle cx="5.5" cy="18.5" r="2.5"/><circle cx="18.5" cy="18.5" r="2.5"/></svg>
                          {% when 'shield' %}
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                          {% when 'ruler' %}
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M21 3H3v7h18V3z"/><path d="M6 10V7"/><path d="M9 10V5"/><path d="M12 10V7"/><path d="M15 10V5"/><path d="M18 10V7"/></svg>
                          {% when 'leaf' %}
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M17 8C8 10 5.9 16.17 3.82 21.34l1.89-.82"/><path d="M17 8c4-1 6 3 6 3s-4 2-8 0"/><path d="M17 8l-5 5"/></svg>
                          {% when 'question' %}
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
                        {% endcase %}
                      </span>
                    {% endif %}
                    {{ block.settings.heading }}
                  </span>
                  <svg class="product__collapsible-chevron" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                </button>
                <div class="product__collapsible-content" data-collapsible-content>
                  <div class="product__collapsible-inner rte">
                    {% if block.settings.page != blank %}
                      {{ block.settings.page.content }}
                    {% else %}
                      {{ block.settings.content }}
                    {% endif %}
                  </div>
                </div>
              </div>

            {% when 'share' %}
              <div class="product__block" {{ block.shopify_attributes }}>
                <div class="product__share">
                  <span class="product__share-label">Share</span>
                  <div class="product__share-links">
                    <a href="https://www.facebook.com/sharer/sharer.php?u={{ shop.url }}{{ product.url }}" target="_blank" rel="noopener" aria-label="Share on Facebook" class="product__share-link">
                      <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"/></svg>
                    </a>
                    <a href="https://twitter.com/intent/tweet?url={{ shop.url }}{{ product.url }}&text={{ product.title | url_encode }}" target="_blank" rel="noopener" aria-label="Share on Twitter" class="product__share-link">
                      <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M23 3a10.9 10.9 0 01-3.14 1.53 4.48 4.48 0 00-7.86 3v1A10.66 10.66 0 013 4s-4 9 5 13a11.64 11.64 0 01-7 2c9 5 20 0 20-11.5a4.5 4.5 0 00-.08-.83A7.72 7.72 0 0023 3z"/></svg>
                    </a>
                    <a href="mailto:?subject={{ product.title | url_encode }}&body={{ shop.url }}{{ product.url }}" aria-label="Share via email" class="product__share-link">
                      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
                    </a>
                  </div>
                </div>
              </div>

            {% when 'custom_liquid' %}
              <div class="product__block" {{ block.shopify_attributes }}>
                {{ block.settings.custom_liquid }}
              </div>

            {% when 'rating' %}
              <div class="product__block" {{ block.shopify_attributes }}>
                <div class="product__rating">
                  <div class="product__rating-stars">
                    {% for i in (1..5) %}
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="{% if i <= block.settings.rating %}var(--color-accent){% else %}none{% endif %}" stroke="var(--color-accent)" stroke-width="1.5">
                        <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                      </svg>
                    {% endfor %}
                  </div>
                  {% if block.settings.review_count > 0 %}
                    <span class="product__rating-count">({{ block.settings.review_count }} reviews)</span>
                  {% endif %}
                </div>
              </div>

            {% when 'separator' %}
              <div class="product__block" {{ block.shopify_attributes }}>
                <hr class="product__separator">
              </div>

            {% when 'text' %}
              <div class="product__block" {{ block.shopify_attributes }}>
                <div class="product__custom-text rte">
                  {{ block.settings.text }}
                </div>
              </div>

          {% endcase %}
        {% endfor %}
      </div>
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Product Page",
  "tag": "section",
  "class": "section-product",
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "label": "Show vendor",
      "default": true
    },
    {
      "type": "header",
      "content": "Typography"
    },
    {
      "type": "select",
      "id": "heading_size",
      "label": "Title size",
      "options": [
        { "value": "small", "label": "Small" },
        { "value": "medium", "label": "Medium" },
        { "value": "large", "label": "Large" }
      ],
      "default": "medium"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "select",
      "id": "gallery_layout",
      "label": "Gallery layout",
      "options": [
        { "value": "thumbnails_bottom", "label": "Thumbnails below" },
        { "value": "thumbnails_left", "label": "Thumbnails left" }
      ],
      "default": "thumbnails_bottom"
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "Top padding",
      "min": 0,
      "max": 100,
      "step": 4,
      "default": 40,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Bottom padding",
      "min": 0,
      "max": 100,
      "step": 4,
      "default": 40,
      "unit": "px"
    }
  ],
  "blocks": [
    {
      "type": "title",
      "name": "Title",
      "limit": 1
    },
    {
      "type": "price",
      "name": "Price",
      "limit": 1,
      "settings": [
        {
          "type": "checkbox",
          "id": "show_tax_notice",
          "label": "Show tax notice",
          "default": false
        },
        {
          "type": "text",
          "id": "tax_text",
          "label": "Tax notice text",
          "default": "Tax included. Shipping calculated at checkout."
        }
      ]
    },
    {
      "type": "variant_picker",
      "name": "Variant Picker",
      "limit": 1
    },
    {
      "type": "quantity_selector",
      "name": "Quantity Selector",
      "limit": 1
    },
    {
      "type": "buy_buttons",
      "name": "Buy Buttons",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "button_text",
          "label": "Add to cart text",
          "default": "Add to Cart"
        },
        {
          "type": "checkbox",
          "id": "show_dynamic_checkout",
          "label": "Show dynamic checkout button",
          "default": true
        }
      ]
    },
    {
      "type": "description",
      "name": "Description",
      "limit": 1
    },
    {
      "type": "collapsible_tab",
      "name": "Collapsible Tab",
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default": "Specifications"
        },
        {
          "type": "select",
          "id": "icon",
          "label": "Icon",
          "options": [
            { "value": "none", "label": "None" },
            { "value": "box", "label": "Package" },
            { "value": "truck", "label": "Shipping" },
            { "value": "shield", "label": "Warranty" },
            { "value": "ruler", "label": "Dimensions" },
            { "value": "leaf", "label": "Materials" },
            { "value": "question", "label": "FAQ" }
          ],
          "default": "box"
        },
        {
          "type": "richtext",
          "id": "content",
          "label": "Content",
          "default": "<p>Share product specifications or other details here.</p>"
        },
        {
          "type": "page",
          "id": "page",
          "label": "Or use content from page"
        }
      ]
    },
    {
      "type": "separator",
      "name": "Separator"
    },
    {
      "type": "text",
      "name": "Custom Text",
      "settings": [
        {
          "type": "richtext",
          "id": "text",
          "label": "Text",
          "default": "<p>Pair text with an image to focus on your chosen product, collection, or blog post.</p>"
        }
      ]
    },
    {
      "type": "share",
      "name": "Share",
      "limit": 1
    },
    {
      "type": "rating",
      "name": "Star Rating",
      "limit": 1,
      "settings": [
        {
          "type": "range",
          "id": "rating",
          "label": "Rating",
          "min": 1,
          "max": 5,
          "step": 1,
          "default": 5
        },
        {
          "type": "number",
          "id": "review_count",
          "label": "Review count",
          "default": 0
        }
      ]
    },
    {
      "type": "custom_liquid",
      "name": "Custom Liquid",
      "settings": [
        {
          "type": "liquid",
          "id": "custom_liquid",
          "label": "Custom Liquid"
        }
      ]
    }
  ]
}
{% endschema %}
