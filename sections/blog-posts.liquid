<section class="blog-posts section {% if section.settings.color_scheme == 'surface' %}section--surface{% endif %}">
  <div class="container">
    {% if section.settings.heading != blank or section.settings.subheading != blank %}
      <div class="section__header">
        {% if section.settings.heading != blank %}
          <h2 class="section__heading">{{ section.settings.heading }}</h2>
        {% endif %}
        {% if section.settings.subheading != blank %}
          <p class="section__subheading">{{ section.settings.subheading }}</p>
        {% endif %}
      </div>
    {% endif %}

    {% assign blog = blogs[section.settings.blog] %}

    {% if blog and blog.articles.size > 0 %}
      <div class="blog-posts__grid blog-posts__grid--{{ section.settings.columns }}">
        {% for article in blog.articles limit: section.settings.post_count %}
          <article class="blog-posts__card">
            {% if article.image %}
              <a href="{{ article.url }}" class="blog-posts__image-wrap">
                <img
                  src="{{ article.image | image_url: width: 540 }}"
                  srcset="
                    {{ article.image | image_url: width: 360 }} 360w,
                    {{ article.image | image_url: width: 540 }} 540w
                  "
                  sizes="(max-width: 768px) 100vw, 33vw"
                  alt="{{ article.image.alt | escape | default: article.title }}"
                  loading="lazy"
                  class="blog-posts__image"
                >
              </a>
            {% endif %}

            <div class="blog-posts__content">
              {% if section.settings.show_date %}
                <time class="blog-posts__date" datetime="{{ article.published_at | date: '%Y-%m-%d' }}">
                  {{ article.published_at | date: '%B %d, %Y' }}
                </time>
              {% endif %}

              <h3 class="blog-posts__title">
                <a href="{{ article.url }}">{{ article.title }}</a>
              </h3>

              {% if section.settings.show_excerpt and article.excerpt_or_content != blank %}
                <p class="blog-posts__excerpt">{{ article.excerpt_or_content | strip_html | truncatewords: 20 }}</p>
              {% endif %}

              {% if section.settings.show_read_more %}
                <a href="{{ article.url }}" class="blog-posts__read-more">
                  Read more
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>
                </a>
              {% endif %}
            </div>
          </article>
        {% endfor %}
      </div>

      {% if section.settings.show_view_all %}
        <div class="blog-posts__view-all">
          <a href="{{ blog.url }}" class="button button--outline">View All Articles</a>
        </div>
      {% endif %}
    {% else %}
      <div class="blog-posts__empty">
        <p>No articles found. Select a blog in the section settings.</p>
      </div>
    {% endif %}
  </div>
</section>

{% schema %}
{
  "name": "Blog Posts",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "From the Journal"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Subheading",
      "default": "Stories, tips, and inspiration for Nordic living."
    },
    {
      "type": "blog",
      "id": "blog",
      "label": "Blog"
    },
    {
      "type": "range",
      "id": "post_count",
      "label": "Number of posts",
      "min": 2,
      "max": 6,
      "step": 1,
      "default": 3
    },
    {
      "type": "select",
      "id": "columns",
      "label": "Columns",
      "options": [
        { "value": "2", "label": "2" },
        { "value": "3", "label": "3" }
      ],
      "default": "3"
    },
    {
      "type": "checkbox",
      "id": "show_date",
      "label": "Show date",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_excerpt",
      "label": "Show excerpt",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_read_more",
      "label": "Show read more link",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_view_all",
      "label": "Show 'View All' button",
      "default": true
    },
    {
      "type": "select",
      "id": "color_scheme",
      "label": "Color scheme",
      "options": [
        { "value": "default", "label": "Default" },
        { "value": "surface", "label": "Surface" }
      ],
      "default": "default"
    }
  ],
  "presets": [
    {
      "name": "Blog Posts"
    }
  ]
}
{% endschema %}
