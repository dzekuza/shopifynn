{%- comment -%}
  Nordic Elite Hot Tub Configurator v2
  Dynamic 15-step configurator reading from Shopify products & collections.
  All product data is serialized to JSON and rendered by configurator.js.
{%- endcomment -%}

{%- assign cfg_id = section.id | replace: '_', '' | downcase -%}
{%- assign tag_name = 'hot-tub-cfg-' | append: cfg_id -%}

{%- comment -%} ═══════════ CSS ═══════════ {%- endcomment -%}
{% stylesheet %}
  /* ── Layout ── */
  .cfg { display: block; width: 100%; font-family: var(--font-body); }
  .cfg__wrap { display: grid; grid-template-columns: 1fr; gap: 40px; max-width: 1400px; margin: 0 auto; padding: 40px 24px; }
  @media (min-width: 990px) { .cfg__wrap { grid-template-columns: 1fr 1fr; gap: 60px; padding: 60px 40px; } }

  /* ── Image panel ── */
  .cfg__images { position: relative; }
  @media (min-width: 990px) { .cfg__images { position: sticky; top: 100px; height: fit-content; } }
  .cfg__main-wrap { position: relative; width: 100%; border-radius: 12px; overflow: hidden; background: var(--color-surface, #EDF2F5); border: 1px solid rgba(0,0,0,.08); margin-bottom: 16px; aspect-ratio: 4/3; }
  .cfg-main-image { width: 100%; height: 100%; object-fit: cover; display: block; transition: opacity .25s ease; }
  .cfg-main-image--fade { opacity: 0; }
  .cfg__placeholder { width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 12px; color: var(--color-text-muted, #86868b); font-size: 14px; text-align: center; padding: 24px; }
  .cfg__placeholder svg { width: 56px; height: 56px; opacity: .35; }
  .cfg__loader { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; background: var(--color-surface, #EDF2F5); }
  .cfg__spinner { width: 28px; height: 28px; border: 3px solid rgba(0,0,0,.08); border-top-color: var(--color-accent, #5EC2AA); border-radius: 50%; animation: cfg-spin .7s linear infinite; }
  @keyframes cfg-spin { to { transform: rotate(360deg); } }
  .cfg__gallery { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
  .cfg-thumb { width: 100%; aspect-ratio: 1; border-radius: 8px; overflow: hidden; border: 2px solid rgba(0,0,0,.08); cursor: pointer; transition: border-color .2s, transform .2s; background: var(--color-surface, #EDF2F5); }
  .cfg-thumb:hover { border-color: var(--color-accent, #5EC2AA); transform: scale(1.04); }
  .cfg-thumb--active { border-color: var(--color-accent, #5EC2AA); border-width: 3px; }
  .cfg-thumb img { width: 100%; height: 100%; object-fit: cover; display: block; }

  /* ── Steps panel ── */
  .cfg__steps { display: flex; flex-direction: column; gap: 32px; }
  .cfg-step { display: flex; flex-direction: column; gap: 14px; }
  .cfg-step--locked { opacity: .25; pointer-events: none; user-select: none; transition: opacity .4s ease; }
  .cfg-step__header { display: flex; align-items: center; gap: 12px; }
  .cfg-step__badge { display: inline-flex; align-items: center; justify-content: center; width: 28px; height: 28px; border-radius: 50%; background: var(--color-accent, #5EC2AA); color: var(--color-primary, #1A2332); font-size: 13px; font-weight: 700; flex-shrink: 0; }
  .cfg-step__title { font-family: var(--font-heading); font-size: 20px; font-weight: 600; color: var(--color-primary, #1A2332); margin: 0; letter-spacing: -.3px; }
  @media (min-width: 990px) { .cfg-step__title { font-size: 24px; } }
  .cfg-step__subtitle { font-size: 14px; color: var(--color-text-muted, #86868b); margin: -6px 0 0 40px; }
  .cfg-step__body { display: flex; flex-direction: column; gap: 12px; }
  .cfg-divider { height: 1px; background: rgba(0,0,0,.08); }

  /* ── Cards ── */
  .cfg-cards { display: flex; flex-direction: column; gap: 10px; }
  .cfg-card { display: flex; align-items: center; justify-content: space-between; padding: 16px 20px; border: 2px solid rgba(0,0,0,.08); border-radius: 12px; background: #fff; cursor: pointer; transition: border-color .2s, box-shadow .2s, background .2s; -webkit-tap-highlight-color: transparent; }
  .cfg-card:hover { border-color: var(--color-accent, #5EC2AA); box-shadow: 0 2px 8px rgba(0,0,0,.08); }
  .cfg-card--selected { border-color: var(--color-accent, #5EC2AA); background: rgba(94,194,170,.08); }
  .cfg-card__info { display: flex; flex-direction: column; gap: 2px; }
  .cfg-card__name { font-family: var(--font-heading); font-size: 17px; font-weight: 600; color: var(--color-primary, #1A2332); margin: 0; }
  .cfg-card__desc { font-size: 13px; color: var(--color-text-muted, #86868b); margin: 0; }
  .cfg-card__meta { font-size: 12px; color: var(--color-text-muted, #86868b); margin: 0; }
  .cfg-card__price { font-size: 15px; font-weight: 500; color: var(--color-primary, #1d1d1f); white-space: nowrap; }

  /* Model tier cards */
  .cfg-card--model { flex-direction: row; gap: 16px; align-items: center; }
  .cfg-card__model-img { width: 80px; height: 80px; border-radius: 10px; object-fit: cover; flex-shrink: 0; background: var(--color-surface, #EDF2F5); }
  @media (min-width: 990px) { .cfg-card__model-img { width: 100px; height: 100px; } }

  /* Size cards */
  .cfg-card--size .cfg-card__info { flex: 1; }

  /* Option cards (heater connection) */
  .cfg-card-options { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
  .cfg-card--option { flex-direction: column; align-items: stretch; padding: 0; overflow: hidden; }
  .cfg-card__img { width: 100%; aspect-ratio: 4/3; object-fit: cover; display: block; background: var(--color-surface, #EDF2F5); }
  .cfg-card__label { font-size: 14px; font-weight: 600; padding: 12px 14px 2px; }
  .cfg-card__sublabel { font-size: 12px; color: var(--color-text-muted, #86868b); padding: 0 14px 12px; }

  /* ── Radio cards ── */
  .cfg-product-list { display: flex; flex-direction: column; gap: 8px; }
  .cfg-radio-card { display: flex; cursor: pointer; -webkit-tap-highlight-color: transparent; }
  .cfg-radio-card__input { position: absolute; opacity: 0; width: 0; height: 0; }
  .cfg-radio-card__body { display: flex; align-items: center; gap: 12px; width: 100%; padding: 10px 14px; border: 2px solid rgba(0,0,0,.08); border-radius: 10px; background: #fff; transition: border-color .2s, background .2s; }
  .cfg-radio-card__input:checked + .cfg-radio-card__body { border-color: var(--color-accent, #5EC2AA); background: rgba(94,194,170,.06); }
  .cfg-radio-card:hover .cfg-radio-card__body { border-color: var(--color-accent, #5EC2AA); }
  .cfg-radio-card__img { width: 56px; height: 56px; border-radius: 8px; object-fit: cover; flex-shrink: 0; background: var(--color-surface, #EDF2F5); }
  @media (min-width: 990px) { .cfg-radio-card__img { width: 64px; height: 64px; } }
  .cfg-radio-card__text { display: flex; flex-direction: column; gap: 2px; flex: 1; min-width: 0; }
  .cfg-radio-card__title { font-size: 15px; font-weight: 500; color: var(--color-primary, #1d1d1f); }
  .cfg-radio-card__desc { font-size: 12px; color: var(--color-text-muted, #86868b); line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
  .cfg-radio-card__price { font-size: 14px; font-weight: 500; color: var(--color-accent-dark, #3A8F7D); white-space: nowrap; flex-shrink: 0; }

  /* ── Checkbox cards ── */
  .cfg-checkbox-card { display: flex; cursor: pointer; -webkit-tap-highlight-color: transparent; }
  .cfg-checkbox-card__input { position: absolute; opacity: 0; width: 0; height: 0; }
  .cfg-checkbox-card__body { display: flex; align-items: center; gap: 12px; width: 100%; padding: 14px 18px; border: 2px solid rgba(0,0,0,.08); border-radius: 10px; background: #fff; transition: border-color .2s, background .2s; }
  .cfg-checkbox-card--checked .cfg-checkbox-card__body,
  .cfg-checkbox-card__input:checked + .cfg-checkbox-card__body { border-color: var(--color-accent, #5EC2AA); background: rgba(94,194,170,.06); }
  .cfg-checkbox-card__check { width: 22px; height: 22px; border-radius: 6px; border: 2px solid rgba(0,0,0,.15); flex-shrink: 0; display: flex; align-items: center; justify-content: center; transition: all .2s; }
  .cfg-checkbox-card--checked .cfg-checkbox-card__check,
  .cfg-checkbox-card__input:checked ~ .cfg-checkbox-card__body .cfg-checkbox-card__check { background: var(--color-accent, #5EC2AA); border-color: var(--color-accent, #5EC2AA); }
  .cfg-checkbox-card__input:checked ~ .cfg-checkbox-card__body .cfg-checkbox-card__check::after,
  .cfg-checkbox-card--checked .cfg-checkbox-card__check::after { content: '✓'; color: #fff; font-size: 14px; font-weight: 700; }
  .cfg-checkbox-card__img { width: 48px; height: 48px; border-radius: 8px; object-fit: cover; flex-shrink: 0; background: var(--color-surface, #EDF2F5); }
  @media (min-width: 990px) { .cfg-checkbox-card__img { width: 56px; height: 56px; } }
  .cfg-checkbox-card__text { display: flex; flex-direction: column; gap: 2px; flex: 1; }
  .cfg-checkbox-card__title { font-size: 15px; font-weight: 500; color: var(--color-primary, #1d1d1f); }
  .cfg-checkbox-card__price { font-size: 13px; color: var(--color-accent-dark, #3A8F7D); }
  .cfg-checkbox-card--compact .cfg-checkbox-card__body { padding: 10px 14px; }

  /* ── Toggle group ── */
  .cfg-toggle-group { display: flex; gap: 8px; margin-bottom: 12px; }
  .cfg-toggle-btn { padding: 8px 18px; border: 2px solid rgba(0,0,0,.08); border-radius: 20px; background: #fff; font-size: 14px; font-weight: 500; cursor: pointer; transition: all .2s; color: var(--color-primary, #1d1d1f); font-family: inherit; }
  .cfg-toggle-btn:hover { border-color: var(--color-accent, #5EC2AA); }
  .cfg-toggle-btn--active { background: var(--color-accent, #5EC2AA); border-color: var(--color-accent, #5EC2AA); color: var(--color-primary, #1A2332); }

  /* ── Swatches ── */
  .cfg-swatches { display: flex; gap: 10px; flex-wrap: wrap; }
  .cfg-swatch { padding: 8px 14px; border: 2px solid rgba(0,0,0,.08); border-radius: 8px; cursor: pointer; transition: all .2s; font-size: 13px; background: #fff; }
  .cfg-swatch:hover { border-color: var(--color-accent, #5EC2AA); }
  .cfg-swatch--selected { border-color: var(--color-accent, #5EC2AA); background: rgba(94,194,170,.1); }
  .cfg-swatch__label { pointer-events: none; }

  /* ── Variant pills ── */
  .cfg-variant-pills { display: flex; gap: 8px; flex-wrap: wrap; }
  .cfg-pill { padding: 8px 16px; border: 2px solid rgba(0,0,0,.08); border-radius: 20px; background: #fff; font-size: 14px; font-weight: 500; cursor: pointer; transition: all .2s; font-family: inherit; color: var(--color-primary, #1d1d1f); }
  .cfg-pill:hover { border-color: var(--color-accent, #5EC2AA); }
  .cfg-pill--selected { background: var(--color-accent, #5EC2AA); border-color: var(--color-accent, #5EC2AA); }
  .cfg-pill__extra { font-size: 12px; color: var(--color-accent-dark, #3A8F7D); }
  .cfg-pill--selected .cfg-pill__extra { color: inherit; }

  /* ── Quantity selector ── */
  .cfg-qty-selector { display: inline-flex; align-items: center; gap: 0; border: 2px solid rgba(0,0,0,.08); border-radius: 10px; overflow: hidden; }
  .cfg-qty-btn { width: 40px; height: 40px; border: none; background: #fff; font-size: 18px; cursor: pointer; transition: background .15s; font-family: inherit; color: var(--color-primary, #1d1d1f); }
  .cfg-qty-btn:hover { background: rgba(0,0,0,.04); }
  .cfg-qty-value { width: 44px; text-align: center; font-size: 16px; font-weight: 600; border-left: 1px solid rgba(0,0,0,.08); border-right: 1px solid rgba(0,0,0,.08); line-height: 40px; }

  /* ── Conditional area ── */
  .cfg-conditional { margin-top: 8px; }
  .cfg-variant-area { margin-top: 10px; }
  .cfg-qty-area { margin-top: 10px; }
  .cfg-label { font-size: 13px; color: var(--color-text-muted, #86868b); margin: 0 0 8px; }
  .cfg-empty { font-size: 14px; color: var(--color-text-muted, #86868b); font-style: italic; }
  .cfg-desc { font-size: 14px; color: var(--color-text-muted, #86868b); line-height: 1.5; margin: 0; }
  .cfg-note { font-size: 12px; color: var(--color-text-muted, #86868b); margin-top: 8px; }

  /* ── Tooltip ── */
  .cfg-tooltip-btn { width: 20px; height: 20px; border-radius: 50%; border: 1.5px solid rgba(0,0,0,.15); background: #fff; font-size: 12px; font-weight: 700; cursor: pointer; display: inline-flex; align-items: center; justify-content: center; color: var(--color-text-muted, #86868b); flex-shrink: 0; position: relative; }
  .cfg-tooltip { position: absolute; bottom: calc(100% + 8px); left: 50%; transform: translateX(-50%); background: var(--color-primary, #1A2332); color: #fff; padding: 10px 14px; border-radius: 8px; font-size: 13px; line-height: 1.5; width: 260px; z-index: 100; box-shadow: 0 4px 16px rgba(0,0,0,.2); font-weight: 400; pointer-events: none; }

  /* ── Diagram ── */
  .cfg-diagram-img { width: 100%; border-radius: 10px; border: 1px solid rgba(0,0,0,.08); }
  .cfg-diagram-placeholder { padding: 40px; text-align: center; background: var(--color-surface, #EDF2F5); border-radius: 10px; color: var(--color-text-muted, #86868b); font-size: 14px; }

  /* ── Add-on list ── */
  .cfg-addon-list { display: flex; flex-direction: column; gap: 8px; margin-top: 12px; }

  /* ── Summary ── */
  .cfg-summary-item { font-size: 14px; color: var(--color-primary, #1d1d1f); line-height: 1.6; }
  .cfg-summary-item::marker { color: var(--color-accent, #5EC2AA); }

  /* ── Toast notification ── */
  .cfg-toast { position: fixed; bottom: 2rem; left: 50%; transform: translateX(-50%) translateY(1rem); background: var(--color-primary, #262626); color: var(--color-background, #F4F1EC); padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-size: 0.9rem; opacity: 0; transition: opacity 0.3s ease, transform 0.3s ease; z-index: 1000; pointer-events: none; max-width: 90vw; text-align: center; }
  .cfg-toast--visible { opacity: 1; transform: translateX(-50%) translateY(0); }

  /* ── Retry button ── */
  .cfg__retry-btn { display: inline-block; margin-left: 1rem; padding: 0.375rem 1rem; background: var(--color-accent, #C85E3F); color: #fff; border: none; border-radius: 0.25rem; cursor: pointer; font-size: 0.85rem; font-family: inherit; }
  .cfg__retry-btn:hover { opacity: 0.9; }

  /* ── Grouped summary card ── */
  .cfg-summary { background: var(--color-surface, #EDE7DD); border-radius: 0.5rem; padding: 1.5rem; margin-bottom: 1.5rem; }
  .cfg-summary__group { margin-bottom: 0.75rem; }
  .cfg-summary__group:last-child { margin-bottom: 0; }
  .cfg-summary__heading { font-weight: 600; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.25rem; color: var(--color-text-muted, #7D7B78); }
  .cfg-summary__items { padding-left: 1rem; font-size: 0.9rem; line-height: 1.5; }
  .cfg-summary__total { margin-top: 1rem; padding-top: 0.75rem; border-top: 1px solid var(--color-text-muted, #7D7B78); font-weight: 700; font-size: 1.1rem; }

  /* ── Bottom CTA ── */
  .cfg__bottom { display: flex; flex-direction: column; gap: 16px; padding-top: 28px; border-top: 1px solid rgba(0,0,0,.08); }
  .cfg__total { font-family: var(--font-heading); font-size: 40px; font-weight: 600; color: var(--color-primary, #1A2332); letter-spacing: -1px; }
  @media (min-width: 990px) { .cfg__total { font-size: 48px; } }
  .cfg__cta { padding: 16px 28px; background: var(--color-accent, #5EC2AA); color: var(--color-primary, #1A2332); border: none; border-radius: 12px; font-size: 17px; font-weight: 600; cursor: pointer; transition: background .2s, transform .15s, box-shadow .2s; width: 100%; font-family: inherit; }
  .cfg__cta:hover:not(:disabled) { background: var(--color-secondary, #3A8F7D); color: #fff; transform: translateY(-1px); box-shadow: 0 4px 14px rgba(58,143,125,.35); }
  .cfg__cta:disabled { opacity: .45; cursor: not-allowed; }
  .cfg__error { font-size: 13px; color: #ff3b30; display: none; align-items: center; flex-wrap: wrap; gap: 0.25rem; }
  .cfg__specs-link { color: var(--color-secondary, #3A8F7D); font-size: 15px; text-decoration: none; text-align: center; display: block; }
  .cfg__specs-link:hover { text-decoration: underline; }
{% endstylesheet %}

{% style %}
  .cfg-{{ cfg_id }} { background-color: {{ section.settings.background_color }}; }
  .cfg-{{ cfg_id }} .cfg__wrap { padding-top: {{ section.settings.padding_top }}px; padding-bottom: {{ section.settings.padding_bottom }}px; }
{% endstyle %}

{%- comment -%} ═══════════ HTML ═══════════ {%- endcomment -%}
<{{ tag_name }} class="cfg cfg-{{ cfg_id }}" data-cfg-tag="{{ tag_name }}">
  <div class="cfg__wrap">

    {%- comment -%} ── LEFT: Image panel ── {%- endcomment -%}
    <div class="cfg__images">
      <div class="cfg__main-wrap">
        <div class="cfg__loader" data-img-loading style="display:none;"><div class="cfg__spinner"></div></div>
        <div class="cfg__placeholder" data-main-placeholder>
          {%- if section.settings.default_image != blank -%}
            <img src="{{ section.settings.default_image | image_url: width: 1200 }}" alt="Nordic Elite hot tub" style="width:100%;height:100%;object-fit:cover;" loading="eager">
          {%- else -%}
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="m21 15-5-5L5 21"/></svg>
            <span>Select a model to preview your hot tub</span>
          {%- endif -%}
        </div>
        <img src="" alt="Hot tub preview" class="cfg-main-image" data-main-image loading="eager" style="display:none;">
      </div>
      <div class="cfg__gallery" data-gallery></div>
    </div>

    {%- comment -%} ── RIGHT: Config steps ── {%- endcomment -%}
    <div class="cfg__steps" data-steps>

      {%- for i in (1..15) -%}
        {%- assign locked = '' -%}
        {%- if i > 1 -%}{%- assign locked = ' cfg-step--locked' -%}{%- endif -%}
        {%- assign step_hidden = false -%}

        {%- case i -%}
          {%- when 1 -%}{%- assign s_title = 'Your Hot Tub' -%}{%- assign s_sub = 'Choose model and size.' -%}
          {%- when 2 -%}{%- assign s_title = 'Fiberglass Liner' -%}{%- assign s_sub = 'Select collection & color.' -%}
          {%- when 3 -%}{%- assign s_title = 'Hot Tub Insulation' -%}{%- assign s_sub = 'Additional insulation layer.' -%}
          {%- when 4 -%}{%- assign s_title = 'Heating System' -%}{%- assign s_sub = 'External or internal oven.' -%}
          {%- when 5 -%}{%- assign s_title = 'Exterior Panel' -%}{%- assign s_sub = 'Pick your wood finish.' -%}
          {%- when 6 -%}{%- assign s_title = 'Hydro Massage' -%}{%- assign s_sub = 'Select system & nozzle count.' -%}
          {%- when 7 -%}{%- assign s_title = 'Air System' -%}{%- assign s_sub = 'Select system & nozzle count.' -%}
          {%- when 8 -%}{%- assign s_title = 'Filter System' -%}{%- assign s_sub = 'Filtration options.' -%}
          {%- when 9 -%}{%- assign s_title = 'LED Lighting' -%}{%- assign s_sub = 'Choose lamp size & quantity.' -%}
          {%- when 10 -%}{%- assign s_title = 'Thermometer' -%}{%- assign s_sub = 'Temperature monitoring.' -%}
          {%- when 11 -%}{%- assign s_title = 'Stairs' -%}{%- assign s_sub = 'Matching exterior material.' -%}
          {%- when 12 -%}{%- assign s_title = 'Hot Tub Head Pillows' -%}{%- assign s_sub = 'Comfort accessories.' -%}
          {%- when 13 -%}{%- assign s_title = 'Cover' -%}{%- assign s_sub = 'Protect your hot tub.' -%}
          {%- when 14 -%}{%- assign s_title = 'Control Installation' -%}{%- assign s_sub = 'Mark installation locations.' -%}
          {%- when 15 -%}{%- assign s_title = 'Heater Connection Type' -%}{%- assign s_sub = 'Connection angle.' -%}
        {%- endcase -%}

        <div class="cfg-step{{ locked }}" data-step="{{ i }}">
          <div class="cfg-step__header">
            <span class="cfg-step__badge" aria-hidden="true">{{ i }}</span>
            <h3 class="cfg-step__title">{{ s_title }}</h3>
          </div>
          <p class="cfg-step__subtitle">{{ s_sub }}</p>
          <div class="cfg-step__body">
            {%- comment -%} Content rendered by JS from JSON data {%- endcomment -%}
          </div>
        </div>

        {%- unless i == 15 -%}<div class="cfg-divider"></div>{%- endunless -%}
      {%- endfor -%}

      {%- comment -%} ── Summary ── {%- endcomment -%}
      <div class="cfg-step" data-step="summary">
        <div class="cfg-step__header">
          <span class="cfg-step__badge" aria-hidden="true">✓</span>
          <h3 class="cfg-step__title">Your Configuration</h3>
        </div>
        <div data-summary-list></div>
      </div>

      {%- comment -%} ── Price + CTA ── {%- endcomment -%}
      <div class="cfg__bottom">
        <div data-summary-card style="display:none;"></div>
        <div class="cfg__total" data-total-price aria-live="polite" style="visibility:hidden;">—</div>
        <p class="cfg__error" data-cart-error></p>
        <button class="cfg__cta" data-add-to-cart disabled>Select a model to start</button>
        {%- if section.settings.specs_page != blank -%}
          <a href="{{ section.settings.specs_page }}" class="cfg__specs-link">View full specifications</a>
        {%- endif -%}
      </div>
    </div>
  </div>

  {%- comment -%} ═══════════ PRODUCT DATA (JSON) ═══════════ {%- endcomment -%}
  <script type="application/json" data-configurator-products>
  {
    "base": [
      {%- assign _base_sep = false -%}
      {%- if section.settings.base_classic_collection != blank -%}
        {%- assign col = section.settings.base_classic_collection -%}
        {%- if _base_sep -%},{%- endif -%}
        {
          "key": "classic",
          "title": {{ col.title | json }},
          "image": {% if col.image %}{{ col.image | image_url: width: 600 | json }}{% elsif col.products.first.featured_image %}{{ col.products.first.featured_image | image_url: width: 600 | json }}{% else %}null{% endif %},
          "body": {{ col.description | strip_html | truncate: 200 | json }},
          {%- assign _bp_min = 999999999 -%}{%- for product in col.products -%}{%- if product.price < _bp_min -%}{%- assign _bp_min = product.price -%}{%- endif -%}{%- endfor -%}
          "price": {{ _bp_min | default: 0 }},
          "products": [
            {%- for product in col.products limit: 10 -%}
              {%- unless forloop.first -%},{%- endunless -%}
              {% render 'configurator-product-json', product: product %}
            {%- endfor -%}
          ]
        }
        {%- assign _base_sep = true -%}
      {%- endif -%}
      {%- if section.settings.base_premium_collection != blank -%}
        {%- assign col = section.settings.base_premium_collection -%}
        {%- if _base_sep -%},{%- endif -%}
        {
          "key": "premium",
          "title": {{ col.title | json }},
          "image": {% if col.image %}{{ col.image | image_url: width: 600 | json }}{% elsif col.products.first.featured_image %}{{ col.products.first.featured_image | image_url: width: 600 | json }}{% else %}null{% endif %},
          "body": {{ col.description | strip_html | truncate: 200 | json }},
          {%- assign _bp_min = 999999999 -%}{%- for product in col.products -%}{%- if product.price < _bp_min -%}{%- assign _bp_min = product.price -%}{%- endif -%}{%- endfor -%}
          "price": {{ _bp_min | default: 0 }},
          "products": [
            {%- for product in col.products limit: 10 -%}
              {%- unless forloop.first -%},{%- endunless -%}
              {% render 'configurator-product-json', product: product %}
            {%- endfor -%}
          ]
        }
        {%- assign _base_sep = true -%}
      {%- endif -%}
      {%- if section.settings.base_signature_collection != blank -%}
        {%- assign col = section.settings.base_signature_collection -%}
        {%- if _base_sep -%},{%- endif -%}
        {
          "key": "signature",
          "title": {{ col.title | json }},
          "image": {% if col.image %}{{ col.image | image_url: width: 600 | json }}{% elsif col.products.first.featured_image %}{{ col.products.first.featured_image | image_url: width: 600 | json }}{% else %}null{% endif %},
          "body": {{ col.description | strip_html | truncate: 200 | json }},
          {%- assign _bp_min = 999999999 -%}{%- for product in col.products -%}{%- if product.price < _bp_min -%}{%- assign _bp_min = product.price -%}{%- endif -%}{%- endfor -%}
          "price": {{ _bp_min | default: 0 }},
          "products": [
            {%- for product in col.products limit: 10 -%}
              {%- unless forloop.first -%},{%- endunless -%}
              {% render 'configurator-product-json', product: product %}
            {%- endfor -%}
          ]
        }
        {%- assign _base_sep = true -%}
      {%- endif -%}
    ],

    {%- comment -%} ── Collections → JSON arrays ── {%- endcomment -%}

    {%- comment -%} Liners (Step 2) {%- endcomment -%}
    "liners": [
      {%- if section.settings.liners_collection != blank -%}
        {%- for product in section.settings.liners_collection.products limit: 20 -%}
          {%- unless forloop.first -%},{%- endunless -%}
          {% render 'configurator-product-json', product: product %}
        {%- endfor -%}
      {%- endif -%}
    ],

    {%- comment -%} Insulation (Step 3) — single product stored as array {%- endcomment -%}
    "insulations": [
      {%- if section.settings.insulation_product != blank -%}
        {%- assign product = section.settings.insulation_product -%}
        {% render 'configurator-product-json', product: product %}
      {%- endif -%}
    ],

    "oven_addons": [
      {%- if section.settings.oven_addons_collection != blank -%}
        {%- for product in section.settings.oven_addons_collection.products limit: 10 -%}
          {%- unless forloop.first -%},{%- endunless -%}
          {% render 'configurator-product-json', product: product %}
        {%- endfor -%}
      {%- endif -%}
    ],

    {%- comment -%} Exteriors (Step 5) {%- endcomment -%}
    "exteriors": [
      {%- if section.settings.exteriors_collection != blank -%}
        {%- for product in section.settings.exteriors_collection.products limit: 20 -%}
          {%- unless forloop.first -%},{%- endunless -%}
          {% render 'configurator-product-json', product: product %}
        {%- endfor -%}
      {%- endif -%}
    ],

    {%- comment -%} Hydro Massage (Step 6) {%- endcomment -%}
    "hydro": [
      {%- if section.settings.hydro_collection != blank -%}
        {%- for product in section.settings.hydro_collection.products limit: 10 -%}
          {%- unless forloop.first -%},{%- endunless -%}
          {% render 'configurator-product-json', product: product %}
        {%- endfor -%}
      {%- endif -%}
    ],

    {%- comment -%} Air System (Step 7) {%- endcomment -%}
    "air": [
      {%- if section.settings.air_collection != blank -%}
        {%- for product in section.settings.air_collection.products limit: 10 -%}
          {%- unless forloop.first -%},{%- endunless -%}
          {% render 'configurator-product-json', product: product %}
        {%- endfor -%}
      {%- endif -%}
    ],

    {%- comment -%} Filter System (Step 8) {%- endcomment -%}
    "filters": [
      {%- if section.settings.filters_collection != blank -%}
        {%- for product in section.settings.filters_collection.products limit: 10 -%}
          {%- unless forloop.first -%},{%- endunless -%}
          {% render 'configurator-product-json', product: product %}
        {%- endfor -%}
      {%- endif -%}
    ],

    {%- comment -%} LED Lighting (Step 9) {%- endcomment -%}
    "leds": [
      {%- if section.settings.leds_collection != blank -%}
        {%- for product in section.settings.leds_collection.products limit: 10 -%}
          {%- unless forloop.first -%},{%- endunless -%}
          {% render 'configurator-product-json', product: product %}
        {%- endfor -%}
      {%- endif -%}
    ],

    {%- comment -%} Thermometer (Step 10) {%- endcomment -%}
    "thermometers": [
      {%- if section.settings.thermometers_collection != blank -%}
        {%- for product in section.settings.thermometers_collection.products limit: 10 -%}
          {%- unless forloop.first -%},{%- endunless -%}
          {% render 'configurator-product-json', product: product %}
        {%- endfor -%}
      {%- endif -%}
    ],

    {%- comment -%} Stairs (Step 11) {%- endcomment -%}
    "stairs": [
      {%- if section.settings.stairs_product != blank -%}
        {%- assign product = section.settings.stairs_product -%}
        {% render 'configurator-product-json', product: product %}
      {%- endif -%}
    ],

    {%- comment -%} Pillows (Step 12) {%- endcomment -%}
    "pillows": [
      {%- if section.settings.pillows_product != blank -%}
        {%- assign product = section.settings.pillows_product -%}
        {% render 'configurator-product-json', product: product %}
      {%- endif -%}
    ],

    {%- comment -%} Covers (Step 13) {%- endcomment -%}
    "covers": [
      {%- if section.settings.covers_collection != blank -%}
        {%- for product in section.settings.covers_collection.products limit: 10 -%}
          {%- unless forloop.first -%},{%- endunless -%}
          {% render 'configurator-product-json', product: product %}
        {%- endfor -%}
      {%- endif -%}
    ],

    {%- comment -%} Heater 90° (Step 15) {%- endcomment -%}
    "heater_90": {%- if section.settings.heater_90_product != blank -%}
      {%- assign product = section.settings.heater_90_product -%}
      {% render 'configurator-product-json', product: product %}
    {%- else -%}null{%- endif -%},

    {%- comment -%} Diagram images (Steps 14-15) {%- endcomment -%}
    "diagrams": {
      "controls": {
        "image": {% if section.settings.diagram_controls %}{{ section.settings.diagram_controls | image_url: width: 800 | json }}{% else %}null{% endif %}
      },
      "heater_conn": {
        "straight": {% if section.settings.diagram_heater_straight %}{{ section.settings.diagram_heater_straight | image_url: width: 600 | json }}{% else %}null{% endif %},
        "angle": {% if section.settings.diagram_heater_angle %}{{ section.settings.diagram_heater_angle | image_url: width: 600 | json }}{% else %}null{% endif %}
      }
    }
  }
  </script>
</{{ tag_name }}>

<script src="{{ 'configurator.js' | asset_url }}" defer></script>

{%- comment -%} ═══════════ SCHEMA ═══════════ {%- endcomment -%}
{% schema %}
{
  "name": "Hot Tub Configurator",
  "settings": [
    { "type": "header", "content": "Step 1 — Base Products (Model Tiers)" },
    { "type": "collection", "id": "base_classic_collection", "label": "Nordic Elite Classic collection" },
    { "type": "collection", "id": "base_premium_collection", "label": "Nordic Elite Premium collection" },
    { "type": "collection", "id": "base_signature_collection", "label": "Nordic Elite Signature collection" },

    { "type": "header", "content": "Step 2 — Fiberglass Liners" },
    { "type": "collection", "id": "liners_collection", "label": "Liners collection" },

    { "type": "header", "content": "Step 3 — Insulation" },
    { "type": "product", "id": "insulation_product", "label": "Insulation product" },

    { "type": "header", "content": "Step 4 — Heating System" },
    { "type": "collection", "id": "oven_addons_collection", "label": "Oven add-ons (glass door, chimney)" },

    { "type": "header", "content": "Step 5 — Exterior Panels" },
    { "type": "collection", "id": "exteriors_collection", "label": "Exterior panels collection" },

    { "type": "header", "content": "Step 6 — Hydro Massage" },
    { "type": "collection", "id": "hydro_collection", "label": "Hydro massage collection" },

    { "type": "header", "content": "Step 7 — Air System" },
    { "type": "collection", "id": "air_collection", "label": "Air system collection" },

    { "type": "header", "content": "Step 8 — Filter System" },
    { "type": "collection", "id": "filters_collection", "label": "Filter system collection" },

    { "type": "header", "content": "Step 9 — LED Lighting" },
    { "type": "collection", "id": "leds_collection", "label": "LED lighting collection" },

    { "type": "header", "content": "Step 10 — Thermometer" },
    { "type": "collection", "id": "thermometers_collection", "label": "Thermometer collection" },

    { "type": "header", "content": "Step 11 — Stairs" },
    { "type": "product", "id": "stairs_product", "label": "Stairs product" },

    { "type": "header", "content": "Step 12 — Head Pillows" },
    { "type": "product", "id": "pillows_product", "label": "Head pillow product" },

    { "type": "header", "content": "Step 13 — Covers" },
    { "type": "collection", "id": "covers_collection", "label": "Covers collection" },

    { "type": "header", "content": "Step 15 — Heater Connection" },
    { "type": "product", "id": "heater_90_product", "label": "90° angle connection product" },

    { "type": "header", "content": "Diagram Images (Steps 14-15)" },
    { "type": "image_picker", "id": "diagram_controls", "label": "Control installation diagram" },
    { "type": "image_picker", "id": "diagram_heater_straight", "label": "Heater — straight connection" },
    { "type": "image_picker", "id": "diagram_heater_angle", "label": "Heater — 90° angle connection" },

    { "type": "header", "content": "Design" },
    { "type": "image_picker", "id": "default_image", "label": "Default image (before selection)" },
    { "type": "url", "id": "specs_page", "label": "Full specifications page URL" },
    { "type": "color", "id": "background_color", "label": "Background", "default": "#ffffff" },
    { "type": "range", "id": "padding_top", "label": "Top padding", "min": 0, "max": 100, "step": 4, "default": 40, "unit": "px" },
    { "type": "range", "id": "padding_bottom", "label": "Bottom padding", "min": 0, "max": 100, "step": 4, "default": 40, "unit": "px" }
  ],
  "presets": [
    { "name": "Hot Tub Configurator" }
  ]
}
{% endschema %}
