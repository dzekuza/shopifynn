<section class="product-tiers section {% if section.settings.color_scheme == 'surface' %}section--surface{% elsif section.settings.color_scheme == 'dark' %}section--dark{% endif %}" style="padding-top: {{ section.settings.padding_top }}px; padding-bottom: {{ section.settings.padding_bottom }}px;">
  <div class="container">
    {% if section.settings.heading != blank or section.settings.subheading != blank %}
      <div class="section__header" style="text-align: {{ section.settings.text_alignment }};">
        {% if section.settings.heading != blank %}
          <h2 class="section__heading" style="{% render 'heading-size-vars', desktop: section.settings.heading_size, mobile: section.settings.heading_size_mobile %}">{{ section.settings.heading }}</h2>
        {% endif %}
        {% if section.settings.subheading != blank %}
          <p class="section__subheading" style="font-size: {% if section.settings.text_size == 'small' %}0.875rem{% elsif section.settings.text_size == 'large' %}1.125rem{% else %}1rem{% endif %};">{{ section.settings.subheading }}</p>
        {% endif %}
      </div>
    {% endif %}

    <div class="product-tiers__grid" style="gap: {{ section.settings.grid_gap }}px;">
      {% for block in section.blocks %}
        {%- liquid
          assign tier_product = block.settings.product
          if block.settings.name_override != blank
            assign tier_name = block.settings.name_override
          elsif tier_product != blank
            assign tier_name = tier_product.title
          else
            assign tier_name = block.settings.name_override
          endif

          if tier_product != blank
            assign tier_price_formatted = tier_product.price | money
          endif

          if block.settings.description_override != blank
            assign tier_desc = block.settings.description_override
          elsif tier_product != blank and tier_product.description != blank
            assign tier_desc = tier_product.description | strip_html | truncate: 160
          else
            assign tier_desc = ''
          endif

          if block.settings.image != blank
            assign tier_image = block.settings.image
          elsif tier_product != blank and tier_product.featured_image != blank
            assign tier_image = tier_product.featured_image
          else
            assign tier_image = nil
          endif

          if block.settings.button_url != blank
            assign tier_url = block.settings.button_url
          elsif tier_product != blank
            assign tier_url = tier_product.url
          else
            assign tier_url = '#'
          endif
        -%}

        <div class="product-tiers__card {% if block.settings.featured %}product-tiers__card--featured{% endif %}" {{ block.shopify_attributes }}>
          {% if block.settings.featured %}
            <span class="product-tiers__badge">{{ block.settings.badge_text | default: 'Most Popular' }}</span>
          {% endif %}

          <div class="product-tiers__image-wrap">
            {% if tier_image %}
              <img
                src="{{ tier_image | image_url: width: 600 }}"
                srcset="{{ tier_image | image_url: width: 400 }} 400w, {{ tier_image | image_url: width: 600 }} 600w, {{ tier_image | image_url: width: 800 }} 800w"
                sizes="(min-width: 990px) 33vw, (min-width: 750px) 50vw, 100vw"
                alt="{{ tier_name | escape }}"
                loading="lazy"
                class="product-tiers__image"
              >
            {% else %}
              <div class="product-tiers__placeholder"></div>
            {% endif %}
          </div>

          <div class="product-tiers__info" style="text-align: {{ block.settings.text_alignment }};">
            {% if tier_name != blank %}
              <h3 class="product-tiers__name">{{ tier_name }}</h3>
            {% endif %}

            {% if tier_product != blank %}
              <p class="product-tiers__price">From {{ tier_price_formatted }}</p>
            {% elsif block.settings.price_override != blank %}
              <p class="product-tiers__price">From {{ block.settings.price_override }}</p>
            {% endif %}

            {% if tier_desc != blank %}
              <p class="product-tiers__desc">{{ tier_desc }}</p>
            {% endif %}

            <ul class="product-tiers__features">
              {% if block.settings.feature_1 != blank %}
                <li>{{ block.settings.feature_1 }}</li>
              {% endif %}
              {% if block.settings.feature_2 != blank %}
                <li>{{ block.settings.feature_2 }}</li>
              {% endif %}
              {% if block.settings.feature_3 != blank %}
                <li>{{ block.settings.feature_3 }}</li>
              {% endif %}
              {% if block.settings.feature_4 != blank %}
                <li>{{ block.settings.feature_4 }}</li>
              {% endif %}
              {% if block.settings.feature_5 != blank %}
                <li>{{ block.settings.feature_5 }}</li>
              {% endif %}
              {% if block.settings.feature_6 != blank %}
                <li>{{ block.settings.feature_6 }}</li>
              {% endif %}
            </ul>

            {% if block.settings.button_text != blank %}
              <a href="{{ tier_url }}" class="button {% if block.settings.featured %}button--primary{% else %}button--outline{% endif %}">
                {{ block.settings.button_text }}
              </a>
            {% endif %}
          </div>
        </div>
      {% endfor %}
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Product Tiers",
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Choose Your Experience"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Subheading",
      "default": "Three tiers of Nordic luxury, each built with the same uncompromising quality."
    },
    {
      "type": "header",
      "content": "Typography"
    },
    {
      "type": "select",
      "id": "heading_size",
      "label": "Heading size",
      "options": [
        { "value": "small", "label": "Small" },
        { "value": "medium", "label": "Medium" },
        { "value": "large", "label": "Large" }
      ],
      "default": "medium"
    },
    {
      "type": "select",
      "id": "heading_size_mobile",
      "label": "Heading size (mobile)",
      "options": [
        { "value": "small", "label": "Small" },
        { "value": "medium", "label": "Medium" },
        { "value": "large", "label": "Large" }
      ],
      "default": "medium"
    },
    {
      "type": "select",
      "id": "text_size",
      "label": "Text size",
      "options": [
        { "value": "small", "label": "Small" },
        { "value": "medium", "label": "Medium" },
        { "value": "large", "label": "Large" }
      ],
      "default": "medium"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "select",
      "id": "text_alignment",
      "label": "Text alignment",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" },
        { "value": "right", "label": "Right" }
      ],
      "default": "center"
    },
    {
      "type": "range",
      "id": "grid_gap",
      "label": "Grid gap",
      "min": 8,
      "max": 48,
      "step": 4,
      "default": 24,
      "unit": "px"
    },
    {
      "type": "select",
      "id": "color_scheme",
      "label": "Color scheme",
      "options": [
        { "value": "default", "label": "Default" },
        { "value": "surface", "label": "Surface" },
        { "value": "dark", "label": "Dark" }
      ],
      "default": "surface"
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "Top padding",
      "min": 0,
      "max": 100,
      "step": 4,
      "default": 40,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Bottom padding",
      "min": 0,
      "max": 100,
      "step": 4,
      "default": 40,
      "unit": "px"
    }
  ],
  "blocks": [
    {
      "type": "tier",
      "name": "Product Tier",
      "limit": 4,
      "settings": [
        {
          "type": "product",
          "id": "product",
          "label": "Product"
        },
        {
          "type": "header",
          "content": "Overrides",
          "info": "Leave blank to use product data"
        },
        {
          "type": "text",
          "id": "name_override",
          "label": "Title override"
        },
        {
          "type": "text",
          "id": "price_override",
          "label": "Price override",
          "info": "Only used when no product is selected"
        },
        {
          "type": "textarea",
          "id": "description_override",
          "label": "Description override"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image override"
        },
        {
          "type": "header",
          "content": "Features"
        },
        {
          "type": "text",
          "id": "feature_1",
          "label": "Feature 1",
          "default": "Seats 2-4 persons"
        },
        {
          "type": "text",
          "id": "feature_2",
          "label": "Feature 2",
          "default": "Thermowood exterior"
        },
        {
          "type": "text",
          "id": "feature_3",
          "label": "Feature 3",
          "default": "Energy-efficient heating"
        },
        {
          "type": "text",
          "id": "feature_4",
          "label": "Feature 4",
          "default": "5-year warranty"
        },
        {
          "type": "text",
          "id": "feature_5",
          "label": "Feature 5"
        },
        {
          "type": "text",
          "id": "feature_6",
          "label": "Feature 6"
        },
        {
          "type": "header",
          "content": "Card options"
        },
        {
          "type": "checkbox",
          "id": "featured",
          "label": "Mark as featured",
          "default": false
        },
        {
          "type": "text",
          "id": "badge_text",
          "label": "Badge text",
          "default": "Most Popular",
          "info": "Only shown when 'Mark as featured' is enabled"
        },
        {
          "type": "text",
          "id": "button_text",
          "label": "Button text",
          "default": "Learn More"
        },
        {
          "type": "url",
          "id": "button_url",
          "label": "Button link",
          "info": "Defaults to product page when a product is selected"
        },
        {
          "type": "select",
          "id": "text_alignment",
          "label": "Text alignment",
          "options": [
            { "value": "left", "label": "Left" },
            { "value": "center", "label": "Center" }
          ],
          "default": "center"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Product Tiers",
      "blocks": [
        {
          "type": "tier",
          "settings": {
            "feature_1": "Seats 2-4 persons",
            "feature_2": "Thermowood exterior",
            "feature_3": "Energy-efficient heating",
            "feature_4": "5-year warranty"
          }
        },
        {
          "type": "tier",
          "settings": {
            "feature_1": "Seats 4-6 persons",
            "feature_2": "Premium thermowood finish",
            "feature_3": "Advanced jet system",
            "feature_4": "7-year warranty",
            "featured": true
          }
        },
        {
          "type": "tier",
          "settings": {
            "feature_1": "Seats 6-8 persons",
            "feature_2": "Custom wood & liner selection",
            "feature_3": "Smart temperature control",
            "feature_4": "10-year warranty"
          }
        }
      ]
    }
  ]
}
{% endschema %}
