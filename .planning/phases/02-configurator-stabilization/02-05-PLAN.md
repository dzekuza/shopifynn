---
phase: 02-configurator-stabilization
plan: 05
type: execute
wave: 4
depends_on:
  - "02-04"
files_modified:
  - assets/configurator.js
autonomous: false
requirements:
  - ARCH-03

must_haves:
  truths:
    - "configurator.js is organized into exactly 8 labeled responsibility groups with clear banner comments"
    - "All existing functionality still works after reorganization — no logic changes, only code movement"
  artifacts:
    - path: "assets/configurator.js"
      provides: "Organized configurator code with 8 responsibility groups"
      contains: "CONFIG & CONSTANTS"
  key_links:
    - from: "assets/configurator.js group banners"
      to: "assets/configurator.js methods"
      via: "every method falls under exactly one group banner"
      pattern: "══.*══"
---

<objective>
Reorganize configurator.js internally into 8 clearly labeled responsibility groups with consistent banner comments. This is a pure code movement task — no logic changes.

Purpose: The file is ~1200+ lines with inconsistent internal organization. Formal grouping makes future changes easier to locate and reduces the risk of duplicate logic.
Output: Same `configurator.js` file with 8 banner-delimited sections, identical behavior.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-configurator-stabilization/02-RESEARCH.md
@.planning/phases/02-configurator-stabilization/02-04-SUMMARY.md

@assets/configurator.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Reorganize configurator.js into 8 responsibility groups</name>
  <files>assets/configurator.js</files>
  <action>
1. Read the entire `assets/configurator.js` file.

2. Identify every method, function, and constant declaration. Classify each into one of these 8 groups:

```
/* ══ 1. CONFIG & CONSTANTS ══════════════════════════════════════ */
// money() function, step definitions, required steps list, any top-level constants

/* ══ 2. LIFECYCLE & INITIALIZATION ══════════════════════════════ */
// constructor(), connectedCallback(), _init(), _cacheEls()

/* ══ 3. STEP RENDERING ══════════════════════════════════════════ */
// _renderStep(), _showStep(), _showVariants(), step-specific render methods

/* ══ 4. EVENT HANDLING ══════════════════════════════════════════ */
// _bindEvents(), all delegated click handlers, _handleNext(), _handlePrev()

/* ══ 5. PRODUCT RESOLUTION ══════════════════════════════════════ */
// _getSizeFromProduct(), _isInternalOvenProduct(), _resolveBaseProduct(), product lookup methods

/* ══ 6. PRICE CALCULATION ═══════════════════════════════════════ */
// _calculateLineItems(), _updatePrice(), _buildConfigSummary()

/* ══ 7. CART & VALIDATION ═══════════════════════════════════════ */
// _handleAddToCart(), _buildCartItems(), _validateRequiredSteps(), _showError(), _hideError()

/* ══ 8. UI UTILITIES ════════════════════════════════════════════ */
// _showToast(), _updateImage(), DOM helper methods, _scrollToTop()
```

3. Physically reorder the methods within the class to match the group order. Move each method under its group banner.

4. CRITICAL: Do NOT change ANY logic, variable names, method signatures, or behavior. This is PURELY a reorganization. The only new content is the 8 banner comments.

5. Remove any existing inconsistent section comments that the new banners replace.

6. After reorganization, the file structure should be:
   - Top-level constants and helper functions (money, etc.) ABOVE the class
   - Class definition with 8 groups in order
   - customElements.define() call at the bottom
  </action>
  <verify>
- Count banner comments matching `══.*══` pattern — exactly 8 must exist
- Grep for each group name: "CONFIG & CONSTANTS", "LIFECYCLE & INITIALIZATION", "STEP RENDERING", "EVENT HANDLING", "PRODUCT RESOLUTION", "PRICE CALCULATION", "CART & VALIDATION", "UI UTILITIES"
- The file parses without JS syntax errors (no missing braces, unclosed methods)
- All methods that existed before reorganization still exist after
  </verify>
  <done>configurator.js has 8 clearly labeled responsibility groups. All methods are classified. No logic changes.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify configurator functionality after reorganization</name>
  <files>assets/configurator.js</files>
  <action>
Human verification checkpoint. Reorganized configurator.js into 8 responsibility groups (pure code movement, no logic changes). Also validates all prior Phase 2 work: metafield-based product resolution, unified pricing, step validation, error recovery, grouped summary, CSS extraction.

Steps to verify:
1. Run `shopify theme dev` to start the local dev server
2. Navigate to the configurator page
3. Verify CSS loads correctly (no unstyled content)
4. Complete all 15 steps selecting options at each step
5. Verify the price updates correctly as selections are made
6. On the final step, verify the grouped summary card appears with category headings and a single total
7. Click "Add to Cart" — verify the correct items appear in the cart with matching prices
8. Check the cart for a "Configuration" line item property with the grouped summary text
9. Try advancing without selecting a required option — verify toast message appears
10. Navigate to a non-configurator page — verify configurator CSS is NOT loaded (view page source)
  </action>
  <verify>User confirms all 10 verification steps pass without issues</verify>
  <done>Full Phase 2 functionality verified by human testing: configurator works end-to-end with all stabilization improvements</done>
</task>

</tasks>

<verification>
1. configurator.js has exactly 8 banner comments in the specified order
2. All methods from before reorganization exist and are in the correct group
3. The configurator page functions identically to pre-reorganization
4. No JavaScript console errors on the configurator page
5. Full 15-step flow works end-to-end with correct cart behavior
</verification>

<success_criteria>
- 8 responsibility groups with consistent banner format
- Zero logic changes — purely structural reorganization
- Full configurator flow works: step navigation, validation, pricing, cart add, summary display
</success_criteria>

<output>
After completion, create `.planning/phases/02-configurator-stabilization/02-05-SUMMARY.md`
</output>
