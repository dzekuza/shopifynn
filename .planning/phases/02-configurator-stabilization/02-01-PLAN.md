---
phase: 02-configurator-stabilization
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - sections/configurator.liquid
  - assets/configurator.css
  - layout/theme.liquid
autonomous: true
requirements:
  - ARCH-01
  - ARCH-02

must_haves:
  truths:
    - "Configurator page loads with all CSS styles intact — no visual regressions"
    - "Configurator CSS does NOT load on non-configurator pages (e.g., homepage, product page)"
    - "The sections/configurator.liquid file contains no {% stylesheet %} block"
  artifacts:
    - path: "assets/configurator.css"
      provides: "Extracted configurator styles"
      contains: ".cfg"
    - path: "sections/configurator.liquid"
      provides: "Section file without embedded CSS"
    - path: "layout/theme.liquid"
      provides: "Conditional configurator.css loading"
      contains: "configurator.css"
  key_links:
    - from: "layout/theme.liquid"
      to: "assets/configurator.css"
      via: "conditional stylesheet_tag with template.suffix check"
      pattern: "template\\.suffix.*configurator.*configurator\\.css"
---

<objective>
Extract configurator CSS from the section {% stylesheet %} block into a standalone asset file, and load it conditionally only on the configurator template.

Purpose: The embedded {% stylesheet %} block loads globally regardless of page. Extracting to an asset file enables browser caching and eliminates unnecessary CSS on non-configurator pages.
Output: `assets/configurator.css` file, cleaned `sections/configurator.liquid`, updated `layout/theme.liquid` with conditional load.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-configurator-stabilization/02-RESEARCH.md

@sections/configurator.liquid
@layout/theme.liquid
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extract configurator CSS to asset file</name>
  <files>sections/configurator.liquid, assets/configurator.css</files>
  <action>
1. Read `sections/configurator.liquid` and locate the `{% stylesheet %}` block (approximately lines 11-165 per research).
2. Copy the entire CSS content from inside the `{% stylesheet %}...{% endstylesheet %}` tags into a new file `assets/configurator.css`. Do NOT include the Liquid tags themselves — only the raw CSS.
3. Remove the entire `{% stylesheet %}...{% endstylesheet %}` block from `sections/configurator.liquid`.
4. Verify the section file still has valid Liquid syntax (no orphaned tags).

The CSS should contain configurator-specific styles (classes starting with `.cfg` or related selectors). Do not modify the CSS content itself — this is a pure extraction.
  </action>
  <verify>
- `assets/configurator.css` exists and contains CSS rules (grep for `.cfg` or similar configurator selectors)
- `sections/configurator.liquid` does NOT contain `{% stylesheet %}` or `{% endstylesheet %}`
- The section file is valid Liquid (no syntax errors in the remaining markup)
  </verify>
  <done>Configurator CSS lives in assets/configurator.css. The section file has no embedded stylesheet block.</done>
</task>

<task type="auto">
  <name>Task 2: Add conditional CSS loading in theme.liquid</name>
  <files>layout/theme.liquid</files>
  <action>
1. Read `layout/theme.liquid` and find the `<head>` section where CSS assets are loaded.
2. Add a conditional block that loads `configurator.css` only on the configurator template:

```liquid
{% if template.suffix == 'configurator' %}
  {{ 'configurator.css' | asset_url | stylesheet_tag }}
{% endif %}
```

Place this AFTER the main `theme.css` stylesheet tag but before the closing `</head>`. This ensures configurator styles can override theme defaults when needed.

IMPORTANT: Use `template.suffix == 'configurator'` (NOT `template.name`). The template file is `page.configurator.json`, so `template.name` is `'page'` and `template.suffix` is `'configurator'`. Using `template.name` would be wrong (see Research Pitfall 3).

3. While in `theme.liquid`, also add the locale injection alongside the existing `window.__shopCurrency` script tag (this prepares for CONF-08 in a later plan):

Find the existing `window.__shopCurrency` assignment and add `window.__shopLocale` on the next line:
```javascript
window.__shopLocale = {{ request.locale.iso_code | json }};
```
  </action>
  <verify>
- `layout/theme.liquid` contains `template.suffix == 'configurator'` conditional with `configurator.css` asset loading
- `layout/theme.liquid` contains `window.__shopLocale` assignment using `request.locale.iso_code`
- The conditional is inside `<head>` and after `theme.css`
  </verify>
  <done>Configurator CSS loads only on configurator pages. Locale variable is injected globally for use by later plans.</done>
</task>

</tasks>

<verification>
1. View the configurator page source — `configurator.css` link tag must be present in `<head>`
2. View any non-configurator page source (e.g., homepage) — `configurator.css` link tag must be ABSENT
3. Configurator page must render with identical styling to before extraction — no visual regressions
4. `window.__shopLocale` must be defined in the page's JavaScript context
</verification>

<success_criteria>
- `assets/configurator.css` exists with all configurator styles
- `sections/configurator.liquid` has no `{% stylesheet %}` block
- `layout/theme.liquid` conditionally loads configurator.css only when `template.suffix == 'configurator'`
- `window.__shopLocale` is injected on all pages
</success_criteria>

<output>
After completion, create `.planning/phases/02-configurator-stabilization/02-01-SUMMARY.md`
</output>
