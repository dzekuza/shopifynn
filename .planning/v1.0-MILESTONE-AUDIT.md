---
milestone: v1.0
audited: 2026-02-20T15:00:00Z
status: gaps_found
scores:
  requirements: 33/36
  phases: 5/8 verified
  integration: 27/28 wired
  flows: 3/4 complete
gaps:
  requirements:
    - id: "SEC-01"
      status: "partial"
      phase: "Phase 1"
      claimed_by_plans: ["01-01-PLAN.md"]
      completed_by_plans: ["01-01-SUMMARY.md"]
      verification_status: "missing"
      evidence: "01-01-SUMMARY claims credentials were rotated on Shopify admin side before plan execution; REQUIREMENTS.md checkbox still [ ] Pending; no VERIFICATION.md for Phase 1"
    - id: "SEC-02"
      status: "partial"
      phase: "Phase 1"
      claimed_by_plans: ["01-01-PLAN.md"]
      completed_by_plans: ["01-01-SUMMARY.md"]
      verification_status: "missing"
      evidence: "01-01-SUMMARY says git history verified clean — scripts were never committed (untracked). No git-filter-repo needed. REQUIREMENTS.md checkbox still [ ] Pending; no VERIFICATION.md"
    - id: "SEC-03"
      status: "partial"
      phase: "Phase 1"
      claimed_by_plans: ["01-01-PLAN.md"]
      completed_by_plans: ["01-01-SUMMARY.md"]
      verification_status: "missing"
      evidence: "01-01-SUMMARY confirms .env in .gitignore, .env.example created, all 5 scripts use process.env. REQUIREMENTS.md checkbox still [ ] Pending; no VERIFICATION.md"
  integration:
    - from: "configurator.js _handleAddToCart()"
      to: "header.liquid [data-cart-count]"
      issue: "cart:refresh CustomEvent dispatched at configurator.js line 1595 but zero listeners exist in theme.js or any other file — header cart count never updates after add-to-cart until page reload"
      affected_requirements: ["CONF-06"]
  flows:
    - name: "Add-to-Cart → Header Cart Count Update"
      breaks_at: "cart:refresh event dispatch — no consumer wired"
      detail: "User adds to cart successfully, button shows 'Added to Cart!', but header cart badge stays at old count until page reload"
tech_debt:
  - phase: 01-security-foundation
    items:
      - "Missing VERIFICATION.md — phase was never formally verified"
      - "REQUIREMENTS.md checkboxes for SEC-01, SEC-02, SEC-03 still [ ] despite SUMMARY claiming completion"
      - "ROADMAP shows Phase 1 as 'In Progress' (1/2 plans) but both plans have SUMMARY.md"
  - phase: 02-configurator-stabilization
    items:
      - "Missing VERIFICATION.md — phase was never formally verified (CONF-05, CONF-06, CONF-09, ARCH-03 only verified via SUMMARY claims)"
  - phase: 04-visual-polish-and-brand-content
    items:
      - "Missing VERIFICATION.md — phase was never formally verified (VIS-01-04, BRAND-01-03 only verified via SUMMARY claims)"
  - phase: 07-price-unification-locale-formatting
    items:
      - "ROADMAP shows Phase 7 as '0/1 Pending' but VERIFICATION.md exists and shows passed"
  - phase: cross-phase
    items:
      - "CONF-04 traceability conflict — REQUIREMENTS.md maps to Phase 6 but code was implemented during Phase 7 execution"
---

# v1.0 Milestone Audit Report

**Milestone:** Aurowe Theme Overhaul v1.0
**Audited:** 2026-02-20
**Status:** gaps_found
**Previous audit:** 2026-02-20T00:30:00Z (pre-gap-closure — found 11 unsatisfied requirements from regression)

## Executive Summary

Gap closure phases 5-8 successfully recovered all regressions identified in the previous audit. The codebase now has 33 of 36 v1 requirements functionally satisfied. The remaining 3 (SEC-01, SEC-02, SEC-03) are claimed complete by their SUMMARY but have no formal VERIFICATION.md and their REQUIREMENTS.md checkboxes remain unchecked. 3 of 8 phases (1, 2, 4) lack VERIFICATION.md files. One cross-phase integration gap exists: the `cart:refresh` event is dispatched after add-to-cart but has no listener, so the header cart count doesn't update.

## Phase Verification Status

| Phase | VERIFICATION.md | Status | Requirements Covered |
|-------|----------------|--------|---------------------|
| 1. Security Foundation | **MISSING** | Unverified | SEC-01, SEC-02, SEC-03 |
| 2. Configurator Stabilization | **MISSING** | Unverified | CONF-05, CONF-06, CONF-09, ARCH-03 |
| 3. Performance and Accessibility | EXISTS | passed (10/10) | PERF-01-05, A11Y-01-05 |
| 4. Visual Polish and Brand Content | **MISSING** | Unverified | VIS-01-04, BRAND-01-03 |
| 5. XSS Sanitization Recovery | EXISTS | passed (5/5) | SEC-04, SEC-05, SEC-06 |
| 6. Metafield Resolution & Event Delegation | EXISTS | passed (13/13) | CONF-01-04 |
| 7. Price Unification & Locale Formatting | EXISTS | passed (5/5) | CONF-04, CONF-07, CONF-08 |
| 8. CSS Architecture & theme.js Cleanup | EXISTS | passed (4/4) | ARCH-01, ARCH-02, ARCH-04 |

## Requirements Coverage (3-Source Cross-Reference)

### Security Requirements

| REQ-ID | Description | VERIFICATION.md | SUMMARY Frontmatter | REQUIREMENTS.md | Final Status |
|--------|-------------|-----------------|---------------------|-----------------|--------------|
| SEC-01 | Rotate exposed Shopify API credentials | missing | 01-01: listed | `[ ]` Pending | **partial** |
| SEC-02 | Purge credentials from git history | missing | 01-01: listed | `[ ]` Pending | **partial** |
| SEC-03 | Add .env to .gitignore, remove hardcoded credentials | missing | 01-01: listed | `[ ]` Pending | **partial** |
| SEC-04 | Sanitize all innerHTML call sites | Phase 5: SATISFIED | 01-02, 05-01: listed | `[x]` Complete | **satisfied** |
| SEC-05 | Load DOMPurify 3.2.7 from CDN | Phase 5: SATISFIED | 01-02, 05-01: listed | `[x]` Complete | **satisfied** |
| SEC-06 | Remove _escAttr() method | Phase 5: SATISFIED | 01-02, 05-01: listed | `[x]` Complete | **satisfied** |

**SEC-01/02/03 Note:** The 01-01-SUMMARY explicitly claims `requirements-completed: [SEC-01, SEC-02, SEC-03, ARCH-04]`. It states credentials were already rotated on Shopify admin, git history was verified clean (scripts were never committed as tracked files), and .gitignore was updated. These appear functionally complete but lack formal verification.

### Configurator Requirements

| REQ-ID | Description | VERIFICATION.md | SUMMARY Frontmatter | REQUIREMENTS.md | Final Status |
|--------|-------------|-----------------|---------------------|-----------------|--------------|
| CONF-01 | Metafield-based product lookups | Phase 6: SATISFIED | 06-01: listed | `[x]` Complete | **satisfied** |
| CONF-02 | Extend configurator-product-json with metafields | Phase 6: SATISFIED | 06-01: listed | `[x]` Complete | **satisfied** |
| CONF-03 | Delete string-matching fallback methods | Phase 6: SATISFIED | 06-01: listed | `[x]` Complete | **satisfied** |
| CONF-04 | Consolidate price into _calculateLineItems() | Phase 6+7: SATISFIED | 06-02, 07-01: listed | `[x]` Complete | **satisfied** |
| CONF-05 | Step validation before cart | missing (Phase 2) | 02-04: listed | `[x]` Complete | **partial** (verification gap) |
| CONF-06 | Error recovery on cart add failure | missing (Phase 2) | 02-04: listed | `[x]` Complete | **partial** (verification gap) |
| CONF-07 | Event delegation on parent containers | Phase 7: SATISFIED | 07-01: listed | `[x]` Complete | **satisfied** |
| CONF-08 | Locale-aware currency formatting | Phase 7: SATISFIED | 07-01: listed | `[x]` Complete | **satisfied** |
| CONF-09 | Configuration summary for order email | missing (Phase 2) | 02-04: listed | `[x]` Complete | **partial** (verification gap) |

### Performance Requirements

| REQ-ID | VERIFICATION.md | SUMMARY | REQUIREMENTS.md | Final Status |
|--------|-----------------|---------|-----------------|--------------|
| PERF-01 | Phase 3: SATISFIED | 03-04: listed | `[x]` Complete | **satisfied** |
| PERF-02 | Phase 3: SATISFIED | 03-01: listed | `[x]` Complete | **satisfied** |
| PERF-03 | Phase 3: SATISFIED | 03-01: listed | `[x]` Complete | **satisfied** |
| PERF-04 | Phase 3: SATISFIED | 03-04: listed | `[x]` Complete | **satisfied** |
| PERF-05 | Phase 3: SATISFIED | 03-02: listed | `[x]` Complete | **satisfied** |

### Accessibility Requirements

| REQ-ID | VERIFICATION.md | SUMMARY | REQUIREMENTS.md | Final Status |
|--------|-----------------|---------|-----------------|--------------|
| A11Y-01 | Phase 3: SATISFIED | 03-05: listed | `[x]` Complete | **satisfied** |
| A11Y-02 | Phase 3: SATISFIED | 03-04: listed | `[x]` Complete | **satisfied** |
| A11Y-03 | Phase 3: SATISFIED | 03-02: listed | `[x]` Complete | **satisfied** |
| A11Y-04 | Phase 3: SATISFIED | 03-05: listed | `[x]` Complete | **satisfied** |
| A11Y-05 | Phase 3: SATISFIED | 03-01: listed | `[x]` Complete | **satisfied** |

### Visual Polish Requirements

| REQ-ID | VERIFICATION.md | SUMMARY | REQUIREMENTS.md | Final Status |
|--------|-----------------|---------|-----------------|--------------|
| VIS-01 | missing (Phase 4) | 04-01: listed | `[x]` Complete | **partial** (verification gap) |
| VIS-02 | missing (Phase 4) | 04-01: listed | `[x]` Complete | **partial** (verification gap) |
| VIS-03 | missing (Phase 4) | 04-01: listed | `[x]` Complete | **partial** (verification gap) |
| VIS-04 | missing (Phase 4) | 04-01: listed | `[x]` Complete | **partial** (verification gap) |

### Brand Content Requirements

| REQ-ID | VERIFICATION.md | SUMMARY | REQUIREMENTS.md | Final Status |
|--------|-----------------|---------|-----------------|--------------|
| BRAND-01 | missing (Phase 4) | 04-02: listed | `[x]` Complete | **partial** (verification gap) |
| BRAND-02 | missing (Phase 4) | 04-02: listed | `[x]` Complete | **partial** (verification gap) |
| BRAND-03 | missing (Phase 4) | 04-02: listed | `[x]` Complete | **partial** (verification gap) |

### Architecture Requirements

| REQ-ID | VERIFICATION.md | SUMMARY | REQUIREMENTS.md | Final Status |
|--------|-----------------|---------|-----------------|--------------|
| ARCH-01 | Phase 8: SATISFIED | 08-01: listed | `[x]` Complete | **satisfied** |
| ARCH-02 | Phase 8: SATISFIED | 08-01: listed | `[x]` Complete | **satisfied** |
| ARCH-03 | missing (Phase 2) | 02-05: listed | `[x]` Complete | **partial** (verification gap) |
| ARCH-04 | Phase 8: SATISFIED | 01-01, 08-01: listed | `[x]` Complete | **satisfied** |

## Integration Check Results

### Cross-Phase Wiring: 27/28 exports properly wired

The integration checker verified all declared phase exports are correctly wired across the codebase. All gap-closure phases (5-8) successfully recovered the regressions found in the previous audit.

**Key verified wiring:**
- DOMPurify CDN → 12 DOMPurify.sanitize() calls in configurator.js (SEC-04/05/06)
- configurator-product-json.liquid meta.size/oven_type → configurator.js _extractSizes()/_resolveBaseProduct() (CONF-01/02)
- _calculateLineItems() → _updatePrice() + _buildCartItems() (CONF-04)
- theme.liquid __shopLocale/__shopCurrency → money() Intl.NumberFormat (CONF-08)
- _bindEvents() delegation → select-variant, select-thumb, retry-cart, add-to-cart (CONF-07)
- assets/configurator.css → conditional load in theme.liquid (ARCH-01/02)

### Orphaned Export (1)

**`cart:refresh` CustomEvent** — `assets/configurator.js` line 1595
- Dispatched after successful add-to-cart via `window.dispatchEvent(new CustomEvent('cart:refresh'))`
- Zero listeners exist anywhere in the codebase
- Header cart count (`sections/header.liquid` line 130, `[data-cart-count]`) is Liquid-rendered server-side only
- **Impact:** Header cart badge doesn't update after add-to-cart until page reload
- **Fix:** Add ~6 lines to `assets/theme.js` to listen for `cart:refresh` and fetch `/cart.js` to update count

### E2E Flow Status

| Flow | Status | Detail |
|------|--------|--------|
| Configurator 15-step → cart add | **Complete** | All steps render, validation blocks incomplete configs, correct cart payload |
| XSS sanitization chain | **Complete** | DOMPurify loads → 12 sites sanitized → _escAttr deleted |
| CSS delivery (conditional) | **Complete** | configurator.css loads only on configurator template |
| Add-to-Cart → Header cart count | **Broken** | Button shows "Added to Cart!" but header count stale until reload |

## Requirement Coverage Summary

| Status | Count | Requirements |
|--------|-------|-------------|
| **satisfied** (verified) | 23 | SEC-04-06, CONF-01-04, CONF-07-08, PERF-01-05, A11Y-01-05, ARCH-01-02, ARCH-04 |
| **partial** (verification gap) | 10 | CONF-05, CONF-06, CONF-09, ARCH-03, VIS-01-04, BRAND-01-03 |
| **partial** (no verification + unchecked) | 3 | SEC-01, SEC-02, SEC-03 |
| **unsatisfied** | 0 | — |
| **orphaned** | 0 | — |

**Total: 36 requirements — 23 fully verified, 13 partial (documentation/verification gaps)**

## ROADMAP Discrepancies

| Phase | ROADMAP Says | Actual State |
|-------|-------------|--------------|
| Phase 1 | In Progress (1/2) | Both plans have SUMMARY.md — appears complete |
| Phase 7 | Pending (0/1) | Has VERIFICATION.md (passed) + SUMMARY.md — complete |

## Tech Debt Summary

| Phase | Items |
|-------|-------|
| Phase 1 | Missing VERIFICATION.md; SEC-01/02/03 checkboxes unchecked; ROADMAP shows In Progress |
| Phase 2 | Missing VERIFICATION.md for CONF-05, CONF-06, CONF-09, ARCH-03 |
| Phase 4 | Missing VERIFICATION.md for VIS-01-04, BRAND-01-03 |
| Phase 7 | ROADMAP shows Pending but phase is actually complete |
| Cross-phase | CONF-04 traceability conflict (mapped to Phase 6, implemented in Phase 7) |
| Integration | cart:refresh event dispatched but never consumed |

**Total: 6 documentation items + 1 integration gap across 5 areas**

## Recommendations to Close Gaps

1. **Create VERIFICATION.md for Phases 1, 2, 4** — run verifier against current codebase to formally verify remaining 13 partial requirements
2. **Update REQUIREMENTS.md** — mark SEC-01, SEC-02, SEC-03 as `[x]` Complete
3. **Wire cart:refresh listener** — add ~6 lines to `assets/theme.js`:
   ```javascript
   window.addEventListener('cart:refresh', function() {
     fetch('/cart.js').then(function(r) { return r.json(); })
       .then(function(cart) {
         var el = document.querySelector('[data-cart-count]');
         if (el) el.textContent = cart.item_count;
       }).catch(function() {});
   });
   ```
4. **Update ROADMAP** — Phase 1 → Complete, Phase 7 → 1/1 Complete

---

*Audited: 2026-02-20*
*Auditor: Claude (gsd-audit-milestone orchestrator + gsd-integration-checker)*
